import{j as e,r}from"./react-DHqCc_uR.js";import{c as $s}from"./react-dom-CuuQ5-yA.js";import{O as Ae,u as Ie,N as Fs,a as Ee,b as Te,B as Os,R as Ms,c as Pe}from"./react-router-C1rnM6mN.js";import{T as Ve,I as As,S as ze,a as Be,P as Is,C as qe,V as Es,L as Ye,b as Ue,c as Ts,d as Vs,e as He,R as zs,f as Bs,g as Je,h as _e,i as Ge,j as Qe,k as qs,O as Ke,l as Ys,m as We,n as Us,o as Xe,D as Ze,p as Hs,q as es}from"./@radix-ui-ByqPd-ZU.js";import{c as Js}from"./clsx-B-dksMZM.js";import{t as _s}from"./tailwind-merge-D696Ktp4.js";import{C as ss,a as Gs,b as Qs,c as Ks,U as Ce,X as Ws,L as Xs,d as Zs,S as et,M as st,e as ts,f as tt,g as at,h as rt,F as ot,i as nt,j as lt,k as it,D as ct,l as dt,P as mt,m as ut}from"./lucide-react-D5zjcOUG.js";import{c as fe}from"./class-variance-authority-Dp3B9jqt.js";import{j as $e}from"./jsqr-fyFDz0PP.js";import{V as M,O as ht}from"./react-hot-toast-B7KtrtSH.js";import{a as ue}from"./axios-C88pvD_q.js";import{u as xt,F as ft,C as pt,b as as}from"./react-hook-form-Uz6ZXrja.js";import{z as K}from"./zod-mSkvzYyn.js";import{t as rs}from"./@hookform-B-JUM-j1.js";import{r as gt,u as me,w as bt}from"./xlsx-D8wqrsip.js";import"./cookie-Ddo6p1Qn.js";import"./scheduler-DYLXRpC5.js";import"./@floating-ui-DEJPq-br.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-BlIxM1M_.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-4iB6bYdv.js";import"./react-style-singleton-CMA6-1ZH.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-etjUjgc1.js";import"./use-callback-ref-BKF_JUQ0.js";import"./goober-np-fLvOt.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const jt=()=>e.jsxs("main",{className:"w-full h-full",children:[e.jsx(Ae,{}),e.jsx("div",{className:"mt-32"})]}),os=({children:s})=>e.jsx("div",{className:"flex flex-col min-h-screen  items-center justify-center",children:e.jsx("div",{className:"container mx-auto max-w-6xl px-4",children:s})}),ns=({sidebar:s,content:t})=>e.jsxs("div",{className:"flex flex-1 container mx-auto",children:[s,e.jsx("main",{className:"flex-1 ml-4 rounded-xl mt-4 ring-1 ring-secondary p-4",children:t})]}),pe=({children:s,variant:t="default",className:a=""})=>{const o={default:"text-base",title:"font-bold text-xl",subtitle:"text-sm text-gray-500",label:"font-medium text-sm text-gray-500"};return e.jsx("span",{className:`${o[t]} ${a}`,children:s})},vt=()=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{width:40,height:40,src:"/images/logo.png",alt:""}),e.jsx(pe,{variant:"title",children:"Exam Results"})]});function h(...s){return _s(Js(s))}const ne=zs,le=Bs,W=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(Ve,{ref:o,className:h("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-full border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(As,{asChild:!0,children:e.jsx(ss,{className:"h-4 w-4 opacity-50"})})]}));W.displayName=Ve.displayName;const ls=r.forwardRef(({className:s,...t},a)=>e.jsx(ze,{ref:a,className:h("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(Gs,{className:"h-4 w-4"})}));ls.displayName=ze.displayName;const is=r.forwardRef(({className:s,...t},a)=>e.jsx(Be,{ref:a,className:h("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ss,{className:"h-4 w-4"})}));is.displayName=Be.displayName;const X=r.forwardRef(({className:s,children:t,position:a="popper",...o},n)=>e.jsx(Is,{children:e.jsxs(qe,{ref:n,className:h("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...o,children:[e.jsx(ls,{}),e.jsx(Es,{className:h("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(is,{})]})}));X.displayName=qe.displayName;const Nt=r.forwardRef(({className:s,...t},a)=>e.jsx(Ye,{ref:a,className:h("px-2 py-1.5 text-sm font-semibold",s),...t}));Nt.displayName=Ye.displayName;const z=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(Ue,{ref:o,className:h("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ts,{children:e.jsx(Qs,{className:"h-4 w-4"})})}),e.jsx(Vs,{children:t})]}));z.displayName=Ue.displayName;const yt=r.forwardRef(({className:s,...t},a)=>e.jsx(He,{ref:a,className:h("-mx-1 my-1 h-px bg-muted",s),...t}));yt.displayName=He.displayName;const St=({selectedYear:s,setSelectedYear:t})=>e.jsxs(ne,{value:s,onValueChange:t,children:[e.jsx(W,{className:"w-36",children:e.jsx(le,{placeholder:"Year"})}),e.jsxs(X,{children:[e.jsx(z,{value:"2025",children:"2025"}),e.jsx(z,{value:"2024",children:"2024"}),e.jsx(z,{value:"2023",children:"2023"}),e.jsx(z,{value:"2022",children:"2022"}),e.jsx(z,{value:"2021",children:"2021"})]})]}),ee=({icon:s,size:t=4,className:a=""})=>e.jsx(s,{className:`h-${t} w-${t} ${a}`}),wt=fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground  hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground  hover:bg-destructive/90",outline:"border border-input bg-background  hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground  hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=r.forwardRef(({className:s,variant:t,size:a,asChild:o=!1,...n},l)=>{const m=o?Je:"button";return e.jsx(m,{className:h(wt({variant:t,size:a,className:s})),ref:l,...n})});E.displayName="Button";const se=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("rounded-xl border bg-card text-card-foreground ",s),...t}));se.displayName="Card";const te=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("flex flex-col space-y-1.5 p-6",s),...t}));te.displayName="CardHeader";const ae=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("font-semibold leading-none tracking-tight",s),...t}));ae.displayName="CardTitle";const Ct=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("text-sm text-muted-foreground",s),...t}));Ct.displayName="CardDescription";const re=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("p-6 pt-0",s),...t}));re.displayName="CardContent";const cs=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("flex items-center p-6 pt-0",s),...t}));cs.displayName="CardFooter";const ds=qs,Re=r.forwardRef(({className:s,...t},a)=>e.jsx(_e,{ref:a,className:h("inline-flex h-10 gap-4 items-center justify-center rounded-md  p-1 text-muted-foreground",s),...t}));Re.displayName=_e.displayName;const ie=r.forwardRef(({className:s,...t},a)=>e.jsx(Ge,{ref:a,className:h("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-black data-[state=active]:text-white",s),...t}));ie.displayName=Ge.displayName;const ke=r.forwardRef(({className:s,...t},a)=>e.jsx(Qe,{ref:a,className:h("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));ke.displayName=Qe.displayName;const kt=({onScanSuccess:s})=>{const[t,a]=r.useState("camera"),[o,n]=r.useState(!1),[l,m]=r.useState(null),g=r.useRef(null),k=r.useRef(null),j=r.useRef(null),D=async()=>{try{m(null);const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});g.current&&(g.current.srcObject=c,j.current=c,n(!0),requestAnimationFrame(C))}catch(c){m("Camera access denied or not available."),console.error("Error accessing camera:",c)}},y=()=>{j.current&&(j.current.getTracks().forEach(c=>c.stop()),j.current=null),n(!1)},C=()=>{const c=g.current,i=k.current,S=i==null?void 0:i.getContext("2d");if(S&&(c==null?void 0:c.readyState)===(c==null?void 0:c.HAVE_ENOUGH_DATA)){i.height=c==null?void 0:c.videoHeight,i.width=c==null?void 0:c.videoWidth,S==null||S.drawImage(c,0,0,i==null?void 0:i.width,i==null?void 0:i.height);const w=S.getImageData(0,0,i==null?void 0:i.width,i==null?void 0:i.height),A=$e(w.data,w.width,w.height,{inversionAttempts:"dontInvert"});if(A)try{const N=JSON.parse(A.data);if(b(N)){y(),s(N);return}}catch(N){M.error(N instanceof Error?N.message:String(N))}requestAnimationFrame(C)}else requestAnimationFrame(C)},L=c=>{var w;const i=(w=c.target.files)==null?void 0:w[0];if(!i)return;m(null);const S=new FileReader;S.onload=A=>{var T;const N=new Image;N.onload=()=>{const I=document.createElement("canvas"),V=I.getContext("2d");if(!V){m("Could not process image");return}I.width=N.width,I.height=N.height,V.drawImage(N,0,0);const B=V.getImageData(0,0,I.width,I.height),_=$e(B.data,B.width,B.height,{inversionAttempts:"dontInvert"});if(_)try{const H=JSON.parse(_.data);if(b(H)){s(H);return}m("Invalid QR code format")}catch{m("Invalid QR code content")}else m("No QR code found in image")},N.src=(T=A.target)==null?void 0:T.result},S.readAsDataURL(i)},b=c=>typeof c=="object"&&typeof c.token=="string"&&typeof c.number=="string"&&typeof c.isExpired=="boolean";return r.useEffect(()=>(t==="camera"?D():y(),()=>{y()}),[t]),e.jsxs(se,{className:"w-full max-w-md mx-auto",children:[e.jsx(te,{children:e.jsx(ae,{children:"Scan QR Code"})}),e.jsxs(ds,{value:t,onValueChange:a,children:[e.jsxs(Re,{className:"grid w-full grid-cols-2",children:[e.jsxs(ie,{value:"camera",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"})," Camera"]}),e.jsxs(ie,{value:"upload",children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"})," Upload"]})]}),e.jsxs(re,{className:"p-4",children:[e.jsx(ke,{value:"camera",className:"mt-0",children:e.jsxs("div",{className:"relative aspect-video bg-muted rounded overflow-hidden",children:[e.jsx("video",{ref:g,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0}),e.jsx("canvas",{ref:k,className:"hidden"}),o&&e.jsx("div",{className:"absolute inset-0 border-2 border-primary pointer-events-none",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-48 w-48 border-2 border-white border-dashed rounded-lg"})})})]})}),e.jsx(ke,{value:"upload",className:"mt-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-muted-foreground rounded-lg min-h-40",children:[e.jsx(Ce,{className:"h-10 w-10 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-center text-sm text-muted-foreground mb-2",children:"Upload an image containing a QR code"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"qr-file-input",onChange:L}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>{var c;return(c=document.getElementById("qr-file-input"))==null?void 0:c.click()},children:"Select File"})]})})]})]}),l&&e.jsx(cs,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-destructive",children:l})})]})},ge=Hs,Lt=Ys,ms=r.forwardRef(({className:s,...t},a)=>e.jsx(Ke,{ref:a,className:h("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));ms.displayName=Ke.displayName;const ce=r.forwardRef(({className:s,children:t,...a},o)=>e.jsxs(Lt,{children:[e.jsx(ms,{}),e.jsxs(We,{ref:o,className:h("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Us,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ce.displayName=We.displayName;const be=({className:s,...t})=>e.jsx("div",{className:h("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});be.displayName="DialogHeader";const us=({className:s,...t})=>e.jsx("div",{className:h("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});us.displayName="DialogFooter";const de=r.forwardRef(({className:s,...t},a)=>e.jsx(Xe,{ref:a,className:h("text-lg font-semibold leading-none tracking-tight",s),...t}));de.displayName=Xe.displayName;const hs=r.forwardRef(({className:s,...t},a)=>e.jsx(Ze,{ref:a,className:h("text-sm text-muted-foreground",s),...t}));hs.displayName=Ze.displayName;const xs=r.createContext(null),Rt=()=>{const s=sessionStorage.getItem("userData");if(!s)return null;try{return JSON.parse(s)}catch{return null}},Dt=({children:s})=>{const[t,a]=r.useState(!1),[o,n]=r.useState(null),[l,m]=r.useState(!0),g=Ie();r.useEffect(()=>{k()},[]);const k=()=>{const C=Rt();C&&(n(C),a(!0)),m(!1)},y={isAuthenticated:t,userData:o,login:(C,L)=>{const b={token:C,number:L};sessionStorage.setItem("userData",JSON.stringify(b)),n(b),a(!0),M.success("Logged in successfully"),g("/portal")},logout:async()=>{sessionStorage.removeItem("userData"),n(null),a(!1),M.success("Logged out successfully"),g("/")},loading:l};return e.jsx(xs.Provider,{value:y,children:!l&&s})},je=()=>{const s=r.useContext(xs);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Pt=()=>{const[s,t]=r.useState(!1),{login:a,logout:o,isAuthenticated:n}=je(),l=m=>{if(m.isExpired){alert("This QR code has expired. Please use a valid code.");return}a(m.token,m.number),t(!1)};return n?e.jsxs(E,{variant:"outline",size:"sm",className:"flex rounded-full items-center bg-red-50 hover:bg-red-100 text-red-600 border-red-200",onClick:o,children:[e.jsx(ee,{icon:Xs,className:"mr-2"}),"Logout"]}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{variant:"outline",size:"sm",className:"flex rounded-full items-center",onClick:()=>t(!0),children:[e.jsx(ee,{icon:Zs,className:"mr-2"}),"Login"]}),e.jsx(ge,{open:s,onOpenChange:t,children:e.jsxs(ce,{children:[e.jsx(de,{children:"Login with QR Code"}),e.jsx(kt,{onScanSuccess:l})]})})]})},fs=({selectedYear:s,setSelectedYear:t})=>{const{isAuthenticated:a}=je(),o=()=>new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n=()=>{const l=new Date().getHours();return l>=6&&l<18?e.jsx(et,{size:18,className:"text-amber-500 mr-2"}):e.jsx(st,{size:18,className:"text-indigo-400 mr-2"})};return e.jsx("header",{className:"bg-gray-150 border-b border-b-secondary shadow-none",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsx(vt,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a?e.jsxs("div",{className:"flex items-center text-gray-700 italic font-sm",children:[n(),o()]}):e.jsx(St,{selectedYear:s,setSelectedYear:t}),e.jsx(Pt,{})]})]})})},ve=r.forwardRef(({className:s,type:t,...a},o)=>e.jsx("input",{type:t,className:h("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base  transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:o,...a}));ve.displayName="Input";const De=({placeholder:s,value:t,onChange:a,onSearch:o=null})=>e.jsxs("div",{className:"flex w-full",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{icon:ts,className:"absolute left-2 top-2.5 text-gray-500"}),e.jsx(ve,{placeholder:s,className:"pl-8 rounded-full",value:t,onChange:n=>a(n.target.value)})]}),o&&e.jsx("div",{className:"ml-2",children:e.jsx(E,{className:"text-black",onClick:o,children:"Search"})})]}),$t=()=>{const[s,t]=r.useState(""),o=[{id:"locate",name:"Locate Students",path:"/portal/locate",icon:e.jsx(ts,{size:18,className:"text-green-500"})},{id:"distributed",name:"Distributed Students List",path:"/portal/distributed",icon:e.jsx(at,{size:18,className:"text-green-500"})}].filter(n=>n.name.toLowerCase().includes(s.toLowerCase()));return e.jsxs("aside",{className:"w-64 mt-4 rounded-xl bg-white p-4 ring-1 ring-secondary h-full",children:[e.jsx("div",{className:"mb-6",children:e.jsx(De,{placeholder:"Search options...",value:s,onChange:t})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(tt,{size:18,className:"mr-2 text-gray-700"}),e.jsx(pe,{variant:"label",children:"Admin Options"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[o.map(n=>e.jsxs(Fs,{to:n.path,className:({isActive:l})=>`flex items-center p-2 rounded-md transition-colors ${l?"bg-primary text-black":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"mr-2",children:n.icon}),n.name]},n.id)),e.jsx("div",{className:"flex-grow min-h-64"})]})]})]})},Ft=()=>{const[s,t]=r.useState("2024");return e.jsxs(os,{children:[e.jsx(fs,{selectedYear:s,setSelectedYear:t}),e.jsx(ns,{sidebar:e.jsx($t,{}),content:e.jsx(Ae,{})})]})},Ot=({selectedLevel:s,setSelectedLevel:t})=>e.jsx("div",{className:"py-1 border-b border-secondary",children:e.jsx(ds,{defaultValue:s,className:"w-full",children:e.jsxs(Re,{className:"w-full  justify-start",children:[e.jsx(ie,{className:"rounded-full font-bold  bg-secondary",value:"Primary",onClick:()=>t("Primary"),children:"Primary"}),e.jsx(ie,{value:"O'Level",className:"rounded-full  bg-secondary font-bold",onClick:()=>t("O'Level"),children:"O'Level"})]})})}),Mt=fe("relative w-full rounded-lg border border-gray-200 px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 [&>svg~*]:pl-7 dark:border-gray-800 dark:[&>svg]:text-gray-50",{variants:{variant:{default:"bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",destructive:"border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900"}},defaultVariants:{variant:"default"}}),ps=r.forwardRef(({className:s,variant:t,...a},o)=>e.jsx("div",{ref:o,role:"alert",className:h(Mt({variant:t}),s),...a}));ps.displayName="Alert";const At=r.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:h("mb-1 font-medium leading-none tracking-tight",s),...t}));At.displayName="AlertTitle";const gs=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:h("text-sm [&_p]:leading-relaxed",s),...t}));gs.displayName="AlertDescription";const It=()=>e.jsxs(ps,{className:"mb-6",children:[e.jsx(ee,{icon:rt,className:"h-4 w-4"}),e.jsx(gs,{children:"Please enter your registration number to view your examination results"})]}),Et=({registrationNumber:s,setRegistrationNumber:t,handleSearch:a})=>e.jsx("div",{className:"mb-6  p-3 rounded-md ",children:e.jsx(De,{placeholder:"Search by registration number...",value:s,onChange:t,onSearch:a})}),Tt=fe("inline-flex items-center rounded-md border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",{variants:{variant:{default:"border-transparent bg-gray-900 text-gray-50 shadow hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",secondary:"border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",destructive:"border-transparent bg-red-500 text-gray-50 shadow hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",outline:"text-gray-950 dark:text-gray-50"}},defaultVariants:{variant:"default"}});function Vt({className:s,variant:t,...a}){return e.jsx("div",{className:h(Tt({variant:t}),s),...a})}const Ne=()=>e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("div",{className:"relative w-10 h-10",children:[e.jsx("div",{className:"absolute w-6 h-6 border border-white rounded-full"}),e.jsx("div",{className:"absolute w-6 h-6 border border-[#854836] rounded-full border-t-transparent animate-spin"})]})}),zt=({results:s,selectedYear:t,selectedLevel:a})=>e.jsxs(se,{children:[e.jsx(te,{className:"pb-3 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Examination Results"}),e.jsxs(pe,{variant:"subtitle",children:[a," • ",t," • Showing ",s.length," results"]})]}),e.jsxs(Vt,{variant:"outline",className:"flex rounded-full py-2 items-center",children:[e.jsx(ee,{icon:ot,size:4,className:"mr-1 text-black"}),t]})]})}),e.jsx(re,{className:"p-0",children:s.length>0?e.jsx("div",{className:"divide-y",children:s.map(o=>e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:o.name}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1 space-x-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ee,{icon:nt,size:4,className:"mr-1"}),o.regNumber]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:o.level})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-4",children:e.jsx("span",{className:"font-bold text-lg",children:o.score})}),e.jsx(E,{variant:"outline",size:"sm",children:"View Details"})]})]},o.id))}):e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx(Ne,{})})})]}),Bt=({level:s,selectedLevel:t,onClick:a})=>e.jsx(E,{variant:t===s.id?"default":"ghost",className:"w-full text-black font-bold justify-start",onClick:()=>a(s.id),children:s.name}),qt=({sidebarSearch:s,setSidebarSearch:t,selectedLevel:a,setSelectedLevel:o})=>{const l=[{id:"Primary",name:"Primary Level"},{id:"O'Level",name:"O'Level"}].filter(m=>m.name.toLowerCase().includes(s.toLowerCase()));return e.jsxs("aside",{className:"w-64 mt-4 rounded-xl bg-white p-4 ring-1 ring-secondary",children:[e.jsx("div",{className:"mb-6",children:e.jsx(De,{placeholder:"Search levels...",value:s,onChange:t})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(pe,{variant:"label",className:"mb-2 block",children:"Choose Your Level"}),e.jsx("div",{className:"space-y-1",children:l.map(m=>e.jsx(Bt,{level:m,selectedLevel:a,onClick:o},m.id))})]})]})},Yt=()=>{const[s,t]=r.useState("2024"),[a,o]=r.useState("Primary"),[n,l]=r.useState(""),[m,g]=r.useState(""),[k,j]=r.useState(!1),[D,y]=r.useState([]),[C,L]=r.useState({}),b=[{id:1,name:"John Doe",level:"Primary",regNumber:"P2024001",year:"2024",score:"78%"},{id:2,name:"Jane Smith",level:"O'Level",regNumber:"O2024152",year:"2024",score:"82%"},{id:3,name:"Mike Johnson",level:"Primary",regNumber:"P2023087",year:"2023",score:"91%"},{id:4,name:"Sarah Williams",level:"O'Level",regNumber:"O2023045",year:"2023",score:"76%"},{id:5,name:"David Brown",level:"Primary",regNumber:"P2025012",year:"2025",score:"85%"}],c=()=>{if(!n)return;const i=`${n}-${s}-${a}`;if(C[i]){y(C[i]),j(!0);return}setTimeout(()=>{const S=b.filter(w=>w.regNumber.toLowerCase().includes(n.toLowerCase())&&w.year===s&&w.level===a);L(w=>({...w,[i]:S})),y(S),j(!0)},500)};return r.useEffect(()=>{y([]),j(!1)},[s,a]),e.jsxs(os,{children:[e.jsx(fs,{selectedYear:s,setSelectedYear:t}),e.jsx(ns,{sidebar:e.jsx(qt,{sidebarSearch:m,setSidebarSearch:g,selectedLevel:a,setSelectedLevel:o}),content:e.jsxs(e.Fragment,{children:[e.jsx(Ot,{selectedLevel:a,setSelectedLevel:o}),!k&&e.jsx(It,{}),e.jsx(Et,{registrationNumber:n,setRegistrationNumber:l,handleSearch:c}),e.jsx(zt,{results:k?D:[],selectedYear:s,selectedLevel:a})]})})]})},bs=r.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:h("w-full caption-bottom text-sm",s),...t})}));bs.displayName="Table";const js=r.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:h("[&_tr]:border-b",s),...t}));js.displayName="TableHeader";const vs=r.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:h("[&_tr:last-child]:border-0",s),...t}));vs.displayName="TableBody";const Ut=r.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:h("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Ut.displayName="TableFooter";const he=r.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:h("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t}));he.displayName="TableRow";const Ns=r.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:h("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));Ns.displayName="TableHead";const U=r.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:h("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t}));U.displayName="TableCell";const Ht=r.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:h("mt-4 text-sm text-muted-foreground",s),...t}));Ht.displayName="TableCaption";const Jt=({headers:s})=>e.jsx(js,{children:e.jsx(he,{children:s.map((t,a)=>e.jsx(Ns,{className:"text-left",children:t},a))})}),ys=({students:s})=>{const[t,a]=r.useState(null),[o,n]=r.useState(!1),[l,m]=r.useState(null),[g,k]=r.useState(1),[j,D]=r.useState(5),y=(N,T)=>{a(N),m(T),n(!0)},C=["Student Name","Registration","Total Marks","Assigned School","Allocated Combination","Reason"],L=Math.ceil(s.length/j),b=(g-1)*j,c=b+j,i=s.slice(b,c),S=()=>{g<L&&k(g+1)},w=()=>{g>1&&k(g-1)},A=N=>{D(Number(N.target.value)),k(1)};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs(bs,{children:[e.jsx(Jt,{headers:C}),e.jsx(vs,{children:s.length===0?e.jsx(he,{children:e.jsx(U,{colSpan:6,className:"text-center h-32 text-muted-foreground",children:"No students distributed yet."})}):i.map((N,T)=>e.jsxs(he,{className:"hover:bg-gray-50",children:[e.jsx(U,{children:N.name}),e.jsx(U,{children:N.registrationNumber}),e.jsx(U,{children:N.totalMarks||"N/A"}),e.jsx(U,{children:N.assignedSchool||"No match"}),e.jsx(U,{children:N.allocatedCombinations&&N.allocatedCombinations.length>0?N.allocatedCombinations.map(I=>I.combinationName).join(", "):"N/A"}),e.jsx(U,{children:e.jsx(E,{variant:"outline",size:"sm",onClick:()=>y(N.explanation||"No explanation available",N.name),children:"View Reason"})})]},T))})]}),s.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Rows per page:"}),e.jsxs("select",{value:j,onChange:A,className:"p-1 text-sm border rounded",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",g," of ",L||1]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(E,{variant:"outline",size:"sm",onClick:w,disabled:g===1,children:e.jsx(lt,{className:"w-4 h-4"})}),e.jsx(E,{variant:"outline",size:"sm",onClick:S,disabled:g===L||L===0,children:e.jsx(it,{className:"w-4 h-4"})})]})]})]}),e.jsx(ge,{open:o,onOpenChange:n,children:e.jsxs(ce,{className:"max-w-md",children:[e.jsx(be,{children:e.jsxs(de,{children:["Assignment Explanation for ",l]})}),e.jsx("div",{className:"mt-4 text-sm",children:t})]})})]})},Z=({children:s,isLoading:t=!1,disabled:a=!1,onClick:o,...n})=>e.jsx(E,{onClick:o,disabled:t||a,...n,children:t?e.jsx(Ne,{}):s}),_t=fe("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Ss=r.forwardRef(({className:s,...t},a)=>e.jsx(es,{ref:a,className:h(_t(),s),...t}));Ss.displayName=es.displayName;const ws=r.createContext(null),Cs=ft,Gt=s=>e.jsx(ws.Provider,{value:{name:s.name},children:e.jsx(pt,{...s})}),ye=()=>{const s=r.useContext(ws),t=r.useContext(ks),{getFieldState:a,formState:o}=xt();if(!s)throw new Error("useFormField should be used within <FormField>");const n=a(s.name,o);return{id:(t==null?void 0:t.id)??"",name:s.name,formItemId:`${(t==null?void 0:t.id)??""}-form-item`,formDescriptionId:`${(t==null?void 0:t.id)??""}-form-item-description`,formMessageId:`${(t==null?void 0:t.id)??""}-form-item-message`,...n}},ks=r.createContext(null),Ls=r.forwardRef(({className:s,...t},a)=>{const o=r.useId();return e.jsx(ks.Provider,{value:{id:o},children:e.jsx("div",{ref:a,className:h("space-y-2",s),...t})})});Ls.displayName="FormItem";const Rs=r.forwardRef(({className:s,...t},a)=>{const{error:o,formItemId:n}=ye();return e.jsx(Ss,{ref:a,className:h(o&&"text-red-500 dark:text-red-900",s),htmlFor:n,...t})});Rs.displayName="FormLabel";const Ds=r.forwardRef(({...s},t)=>{const{error:a,formItemId:o,formDescriptionId:n,formMessageId:l}=ye();return e.jsx(Je,{ref:t,id:o,"aria-describedby":a?`${n} ${l}`:`${n}`,"aria-invalid":!!a,...s})});Ds.displayName="FormControl";const Qt=r.forwardRef(({className:s,...t},a)=>{const{formDescriptionId:o}=ye();return e.jsx("p",{ref:a,id:o,className:h("text-[0.8rem] text-gray-500 dark:text-gray-400",s),...t})});Qt.displayName="FormDescription";const Kt=r.forwardRef(({className:s,children:t,...a},o)=>{const{error:n,formMessageId:l}=ye(),m=n?String((n==null?void 0:n.message)??""):t;return m?e.jsx("p",{ref:o,id:l,className:h("text-[0.8rem] font-medium text-red-500 dark:text-red-900",s),...a,children:m}):null});Kt.displayName="FormMessage";const xe=({name:s,label:t,options:a,control:o,placeholder:n})=>e.jsx(Gt,{control:o,name:s,render:({field:l})=>e.jsxs(Ls,{children:[e.jsx(Rs,{children:t}),e.jsx(Ds,{children:e.jsxs(ne,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(W,{children:e.jsx(le,{placeholder:n||`Select ${t}`})}),e.jsx(X,{children:a.map(m=>e.jsx(z,{value:m.value,children:m.label},m.value))})]})})]})}),Wt=K.object({year:K.string().min(4,"Year is required"),level:K.string().min(1,"Level is required")}),Fe=({onImport:s,title:t="Import Data",description:a="Upload an Excel file containing data"})=>{const[o,n]=r.useState(!1),[l,m]=r.useState(null),[g,k]=r.useState(null),j=as({resolver:rs(Wt),defaultValues:{year:new Date().getFullYear().toString(),level:"O-Level"}}),D=[{value:"2023",label:"2023"},{value:"2024",label:"2024"},{value:"2025",label:"2025"}],y=[{value:"P-Level",label:"Primary"},{value:"O-Level",label:"Secondary"}],C=b=>{var S;const c=(S=b.target.files)==null?void 0:S[0];if(!c)return;k(c.name);const i=new FileReader;i.onload=w=>{var A;try{const N=(A=w.target)==null?void 0:A.result,T=gt(N,{type:"binary"}),I=T.SheetNames[0],V=T.Sheets[I],B=me.sheet_to_json(V);m(B)}catch(N){console.error("Error parsing Excel file:",N),m(null)}},i.readAsBinaryString(c)},L=b=>{l&&l.length>0&&(s(l,b.year,b.level),n(!1),j.reset(),m(null),k(null))};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{variant:"outline",onClick:()=>n(!0),className:"gap-2",children:[e.jsx(Ce,{className:"text-green-700",size:16}),t]}),e.jsx(ge,{open:o,onOpenChange:n,children:e.jsxs(ce,{className:"sm:max-w-md",children:[e.jsxs(be,{children:[e.jsx(de,{children:t}),e.jsx(hs,{children:a})]}),e.jsx(Cs,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(xe,{name:"year",label:"Academic Year",options:D,control:j.control}),e.jsx(xe,{name:"level",label:"Education Level",options:y,control:j.control})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Upload Excel File"}),e.jsx(ve,{id:"file-upload",type:"file",accept:".xlsx,.xls,.csv",onChange:C}),g&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Selected file: ",g]}),l&&e.jsxs("p",{className:"text-sm text-green-600",children:[l.length," records found"]})]}),e.jsx(us,{className:"mt-4",children:e.jsx(Z,{className:"bg-black hover:text-black",type:"submit",disabled:!l||l.length===0,children:"Import"})})]})})]})})]})},Ps=({data:s,filename:t="distributed-students"})=>{const a=()=>{if(!s||s.length===0)return;const o=me.json_to_sheet(s),n=me.book_new();me.book_append_sheet(n,o,"Students"),bt(n,`${t}.xlsx`)};return e.jsxs(Z,{variant:"outline",onClick:a,disabled:!s||s.length===0,className:"gap-2 bg-green-100 text-green-800",children:[e.jsx(ct,{size:16,className:""}),"Export Excel"]})},Xt=K.object({year:K.string().min(4,"Year is required"),level:K.string().min(1,"Level is required")}),Zt=({onDistribute:s,onSave:t,onImport:a,onUseTestData:o,isDistributing:n,isSaving:l,distributedStudents:m,importedStudentsCount:g=0,importedSchoolsCount:k=0})=>{const j=as({resolver:rs(Xt),defaultValues:{year:new Date().getFullYear().toString(),level:"O-Level"}}),D=[{value:"2023",label:"2023"},{value:"2024",label:"2024"},{value:"2025",label:"2025"}],y=[{value:"P-Level",label:"Primary"},{value:"O-Level",label:"Secondary"}],C=()=>{const{year:b,level:c}=j.getValues();s(b,c)},L=()=>{const{year:b,level:c}=j.getValues();t(b,c)};return e.jsx("div",{className:"p-4 border rounded-lg bg-white shadow-sm",children:e.jsxs(Cs,{...j,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx(xe,{name:"year",label:"Academic Year",options:D,control:j.control}),e.jsx(xe,{name:"level",label:"Education Level",options:y,control:j.control}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[g>0&&e.jsxs("span",{className:"mr-3 px-3 py-2 bg-blue-100 text-blue-800 rounded-full text-xs",children:[g," Students"]}),k>0&&e.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-800 rounded-full text-xs",children:[k," Schools"]})]})})]}),e.jsx("div",{className:"border-primary border w-full my-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(Fe,{onImport:(b,c,i)=>a(b,c,i,"students"),title:"Import Students",description:"Upload an Excel file containing student information"}),e.jsx(Fe,{onImport:(b,c,i)=>a(b,c,i,"schools"),title:"Import Schools",description:"Upload an Excel file containing school information"}),e.jsxs(Z,{onClick:o,className:"gap-2 text-black bg-red-200/25",children:[e.jsx(dt,{size:16}),"Get Data Automatically"]}),e.jsx("div",{className:"border-primary border w-full"}),e.jsxs(Z,{onClick:C,disabled:n||g===0&&k===0,className:"gap-2 text-black",children:[n?e.jsx("div",{className:"mt-4",children:e.jsx(Ne,{})}):e.jsx(mt,{className:"text-green-500 font-bold",size:16}),"Distribute Students"]}),e.jsx(Z,{variant:"outline",onClick:L,disabled:l||m.length===0,className:"gap-2 bg-black text-white",children:l?"save...":"Save Distribution"}),e.jsx(Ps,{data:m,filename:"student-distribution"})]})]})})},ea=({importedData:s,onCardClick:t})=>s.length===0?null:e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((a,o)=>e.jsxs(se,{className:"cursor-pointer bg-yellow-500/10  hover:bg-gray-50 transition-colors",onClick:()=>t(a.data,a.type),children:[e.jsx(te,{className:"pb-2",children:e.jsxs(ae,{className:"text-base",children:[a.type==="students"?"Students":"Schools",": ",a.year," ",a.level]})}),e.jsxs(re,{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[a.count," ",a.type==="students"?"Students":"Schools"]}),e.jsx(E,{variant:"link",className:"p-0 h-auto mt-2 text-blue-600",onClick:n=>{n.stopPropagation(),t(a.data,a.type)},children:"View Details"})]})]},`${a.type}-${a.year}-${a.level}-${o}`))})}),sa=({title:s,onDistribute:t,onSave:a,onImport:o,onUseTestData:n,isDistributing:l,isSaving:m,distributedStudents:g,importedStudentsCount:k,importedSchoolsCount:j,importedData:D=[]})=>{const[y,C]=r.useState(null),[L,b]=r.useState(!1),c=(i,S,w)=>{C({data:i,type:S,title:w}),b(!0)};return e.jsx("div",{className:"container mx-auto py-6 space-y-6",children:e.jsxs(se,{children:[e.jsx(te,{className:"pb-3",children:e.jsx(ae,{children:s})}),e.jsxs(re,{children:[e.jsx(Zt,{onDistribute:t,onSave:a,onImport:o,onUseTestData:n,isDistributing:l,isSaving:m,distributedStudents:g,importedStudentsCount:k,importedSchoolsCount:j}),D.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Imported Data"}),e.jsx(ea,{importedData:D,onCardClick:c})]}),g.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Distributed Students"}),e.jsx(ys,{students:g})]}),e.jsx(ge,{open:L,onOpenChange:b,children:y&&e.jsxs(ce,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(be,{children:e.jsxs(de,{children:[y.title||(y.type==="students"?"Students":"Schools")," ","Details"]})}),y.type==="students"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Name"}),e.jsx("th",{className:"text-left p-2",children:"Registration"}),e.jsx("th",{className:"text-left p-2",children:"Level"}),e.jsx("th",{className:"text-left p-2",children:"Total Marks"})]})}),e.jsx("tbody",{children:y.data.map((i,S)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:i.name}),e.jsx("td",{className:"p-2",children:i.registrationNumber}),e.jsx("td",{className:"p-2",children:i.level}),e.jsx("td",{className:"p-2",children:i.totalMarks})]},S))})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"School Name"}),e.jsx("th",{className:"text-left p-2",children:"Level"}),e.jsx("th",{className:"text-left p-2",children:"Status"}),e.jsx("th",{className:"text-left p-2",children:"Capacity"}),e.jsx("th",{className:"text-left p-2",children:"Location"})]})}),e.jsx("tbody",{children:y.data.map((i,S)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:i.name}),e.jsx("td",{className:"p-2",children:i.level}),e.jsx("td",{className:"p-2",children:i.status}),e.jsx("td",{className:"p-2",children:i.capacity}),e.jsx("td",{className:"p-2",children:i.location})]},S))})]})})]})})]})]})})},ta=()=>{const[s,t]=r.useState([]),[a,o]=r.useState([]),[n,l]=r.useState([]),[m,g]=r.useState(!1),[k,j]=r.useState(!1),[D,y]=r.useState(new Date().getFullYear().toString()),[C,L]=r.useState("O-Level"),[b,c]=r.useState(0),[i,S]=r.useState(0),[w,A]=r.useState([]),[N,T]=r.useState([]),[I,V]=r.useState([]),B=f=>f.map(x=>{try{return{...x,scores:typeof x.scores=="string"?JSON.parse(x.scores):x.scores,preference:typeof x.preference=="string"?JSON.parse(x.preference):x.preference,selectedCombinations:typeof x.selectedCombinations=="string"?JSON.parse(x.selectedCombinations):x.selectedCombinations,totalMarks:typeof x.totalMarks=="string"?parseFloat(x.totalMarks):x.totalMarks}}catch(u){return console.error(`Error parsing data for student ${x.name}:`,u),{...x,scores:[],preference:[],selectedCombinations:[],totalMarks:typeof x.totalMarks=="string"?parseFloat(x.totalMarks)||0:x.totalMarks||0}}}),_=async(f,x)=>{const u={...f,scores:typeof f.scores=="string"?JSON.parse(f.scores):f.scores,preference:typeof f.preference=="string"?JSON.parse(f.preference):f.preference,selectedCombinations:typeof f.selectedCombinations=="string"?JSON.parse(f.selectedCombinations):f.selectedCombinations,totalMarks:typeof f.totalMarks=="string"?parseFloat(f.totalMarks):f.totalMarks},P=`
  # Student Distribution Task
  Distribute the student to an appropriate Rwandan school based on the following information:
  
  ## Student Details
  - Name: ${u.name}
  - Registration Number: ${u.registrationNumber}
  - Individual Subject Marks: ${JSON.stringify(u.scores||[])}
  - Total Marks: ${u.totalMarks}
  - Current Level: ${u.level}
  - Preferred Schools: ${JSON.stringify(u.preference||[])}
  - Preferred Combinations: ${JSON.stringify(u.selectedCombinations||[])}
  
  ## Available Schools
  ${JSON.stringify(x,null,2)}
  
  ## Educational System Rules
  ### Primary to O-Level Transition
  - Primary school students are assigned to O-Level schools based primarily on their total marks
  - Students with total marks below 30% cannot proceed to O-Level and must repeat
  - Students with total marks between 30-50% can only be assigned to Daily or Normal schools
  - Students with total marks above 50% can be assigned to Good or Excellent schools based on availability
  
  ### O-Level to A-Level Transition
  - O-Level students are assigned to A-Level schools based on both their total marks and subject-specific performance
  - Students must have at least 50% total marks to qualify for A-Level
  - Students with below 30% total marks must repeat O-Level
  - Students between 30-50% should be directed to TVET programs
  
  ### Subject Requirements for A-Level Combinations
  - PCM (Physics, Chemistry, Mathematics): Requires strong performance in all three subjects (minimum 60% in each)
  - PCB (Physics, Chemistry, Biology): Requires strong performance in science subjects
  - MCB (Mathematics, Chemistry, Biology): Requires strong performance in Mathematics and sciences
  - MPG (Mathematics, Physics, Geography): Requires good performance in Mathematics and Physics
  - MEG (Mathematics, Economics, Geography): Requires good performance in Mathematics
  - HEG (History, Economics, Geography): Requires good performance in humanities
  - LFK (Literature, French, Kinyarwanda): Requires strong language skills
  - MPC (Mathematics, Physics, Computer Science): Requires strong performance in Mathematics and logical subjects
  - TVET programs: Suitable for students with practical skills and at least 30% total marks
  
  ### School Assignment Priorities
  - Excellent schools: Reserved for top-performing students (above 70% total marks)
  - Good schools: For strong students (above 60% total marks)
  - Normal schools: For average students (above 50% total marks)
  - Daily schools: For students with at least 30% total marks
  
  ## Task Instructions
  1. Analyze the student's academic performance.
  2. If student is from primary level, assess eligibility for O-Level based on total marks only.
  3. If student is from O-Level, assess eligibility for A-Level combinations or TVET based on subject-specific performance.
  4. Match the student to an appropriate school based on their performance and school availability.
  5. Prioritize the student's preferred combinations when possible.
  6. Consider school capacity and available slots.
  7. Provide a clear, detailed explanation for the assignment decision.
  
  ## Output Format
  Return a JSON object with the following structure:
  {
    "studentName": "${u.name}",
    "registration": "${u.registrationNumber}",
    "totalMarks": ${u.totalMarks},
    "allocatedSchool": "Name of assigned school",
    "level": "${u.level==="Primary"?"O-Level":u.level==="O-Level"?"A-Level":u.level}",
    "allocatedCombinations": [{"combinationName": "Assigned combination", "school": "School name"}],
    "reason": "Detailed explanation of the assignment decision with specific references to the student's performance and the school's characteristics"
  }
  `;try{const O=(await ue.post("https://api.cohere.ai/generate",{model:"command-r-plus-04-2024",prompt:P,max_tokens:300,temperature:1},{headers:{Authorization:"Bearer KsOdw0sxTnTchrOfPLtHH3MAzAp0E4opUSl48Phl"}})).data.text.match(/\{[\s\S]*\}/);if(O)return JSON.parse(O[0]);throw new Error("Invalid response structure")}catch(v){return console.error("Error during distribution:",v),{studentName:u.name,registration:u.registrationNumber,totalMarks:u.totalMarks,allocatedSchool:"Error in distribution",level:u.level,allocatedCombinations:[],reason:"An error occurred during distribution"}}},H=async(f,x)=>{if(!(m||a.length===0)){g(!0);try{const P=B(a).filter(F=>F.level===x);if(P.length===0){M.error(`No students found for ${x} level`),g(!1);return}const v=P.map(F=>_(F,n)),O=await Promise.all(v),p=P.map((F,q)=>({...F,assignedSchool:O[q].allocatedSchool,allocatedCombinations:O[q].allocatedCombinations||[],explanation:O[q].reason}));t(p),y(f),L(x),M.success("Students distributed successfully")}catch(u){console.error("Error distributing students:",u),M.error("Failed to distribute students")}finally{g(!1)}}},d=(f,x)=>{if(a.length===0){M.error("No students available to distribute");return}H(f,x)},R=async(f,x)=>{if(s.length===0){M.error("No distributed students to save");return}j(!0);try{const u={year:f,level:x,distributions:s.map(v=>({...v,name:v.name,registrationNumber:v.registrationNumber,assignedSchool:v.assignedSchool,allocatedCombinations:v.allocatedCombinations,explanation:v.explanation,totalMarks:v.totalMarks}))},P=await ue.post("http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distribution",u);if(P.data.success)M.success("Distribution saved successfully");else throw new Error(P.data.message||"Failed to save distribution")}catch(u){console.error("Error saving distribution:",u),M.error(u instanceof Error?u.message:"Failed to save distribution")}finally{j(!1)}},$=(f,x,u,P)=>{if(!f||f.length===0){M.error(`No ${P} data found in imported file`);return}try{if(P==="students"){console.log("importedData",f);const v=f.map((p,F)=>{const q=p.scores?p.scores.map(J=>({...J,marks:Math.min(J.marks,100)})):[];return console.log("item",p),{id:p.id||`S${F+1}`,name:p.name||p.Name||"",registrationNumber:p.registrationNumber||p.Registration||`REG${F+1}`,scores:q,totalMarks:Math.min(Number(p.totalMarks||p.TotalMarks||0),600),level:p.level||u,preference:p.preference||[],selectedCombinations:p.selectedCombinations||null,allocatedCombinations:null}});o(v),c(v.length);const O={type:"students",year:x,level:u,count:v.length,data:v};V(p=>[...p,O]),M.success(`Imported ${v.length} students for ${x} - ${u}`)}else{const v=f.map((p,F)=>({id:p.id||`SCH${F+1}`,name:p.name||p.Name||"",status:p.status||"normal",level:p.level||"O-Level",combinations:p.combinations||[],capacity:Number(p.capacity||300),location:p.location||"",code:p.code||`${F+1e3}`,availableSlots:p.availableSlots||100,otherSchoolDetails:p.otherSchoolDetails||{}}));l(v),S(v.length);const O={type:"schools",year:x,level:u,count:v.length,data:v};V(p=>[...p,O]),M.success(`Imported ${v.length} schools for ${x}`)}y(x),L(u)}catch(v){console.error(`Error processing imported ${P} data:`,v),M.error(`Failed to process imported ${P} data`)}},oe=()=>{const f=(p,F)=>Array.from({length:p},(q,J)=>{const G=["Mathematics","English","Science","Physics","Chemistry","Biology","Geography","History"].slice(0,6).map(Q=>({course:Q,marks:Math.floor(Math.random()*60)+40})),Se=G.reduce((Q,{marks:we})=>Q+we,0);return{id:`S${J+1}`,name:`Student ${J+1}`,registrationNumber:`REG${1e4+J}`,scores:G,totalMarks:Se,level:F,preference:["School A","School B","School C"],selectedCombinations:F==="O-Level"?[{combinationName:"PCM",school:"School A"},{combinationName:"PCB",school:"School B"}]:null,allocatedCombinations:null}}),x=()=>{const p=["Primary","O-Level","A-Level","TVET"],F=["excellent","good","normal","daily"],q=["PCM","PCB","MCB","MEG","HEG","LFK","MPC"];return Array.from({length:10},(J,Y)=>{const G=p[Y%4],Se=q.reduce((Q,we)=>(Q[we]={totalSlots:50,remainingSlots:50-Math.floor(Math.random()*20)},Q),{});return{id:`SCH${Y+1}`,name:`School ${String.fromCharCode(65+Y)}`,status:F[Y%4],level:G,combinations:G==="A-Level"?q.slice(0,3):[],capacity:300+Y*50,location:`District ${Math.floor(Y/3)+1}`,code:`${1e3+Y}`,availableSlots:G==="A-Level"?Se:100}})},u=f(20,"Primary"),P=f(30,"O-Level"),v=x(),O=[...u,...P];o(O),l(v),c(O.length),S(v.length),V([{type:"students",year:D,level:"Primary",count:u.length,data:u},{type:"students",year:D,level:"O-Level",count:P.length,data:P},{type:"schools",year:D,level:"All",count:v.length,data:v}]),M.success("Test data loaded successfully")};return e.jsx(sa,{title:"Student Distribution",onDistribute:d,onSave:R,onImport:$,onUseTestData:oe,isDistributing:m,isSaving:k,distributedStudents:s,importedStudentsCount:b,importedSchoolsCount:i,importedData:I})};var Le=(s=>(s.PRIMARY="P-Level",s.SECONDARY="O-Level",s))(Le||{});const aa=()=>{const[s,t]=r.useState([]),[a,o]=r.useState([]),[n,l]=r.useState([]),[m,g]=r.useState([]),[k,j]=r.useState(!1),[D,y]=r.useState(null),[C,L]=r.useState(""),[b,c]=r.useState(Le.SECONDARY),[i,S]=r.useState(null),[w,A]=r.useState("");Ie(),r.useEffect(()=>{(async()=>{try{const R=await ue.get("http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distribution");if(R.data.success){console.log("response",R.data);const $=Array.from(new Set(R.data.data.map(oe=>new Date(oe.createdAt).getFullYear().toString())));l($),$.length>0&&L($[0])}}catch(R){console.error("Error fetching years:",R),y("Failed to load available years")}})()},[]),r.useEffect(()=>{C&&b&&N(C,b)},[C,b]),r.useEffect(()=>{if(s.length>0){const d=Array.from(new Set(s.map(R=>R.assignedSchool))).filter(Boolean).sort();g(d)}},[s]),r.useEffect(()=>{if(s.length>0){let d=[...s];i?d=d.filter(R=>R.assignedSchool===i):w&&(d=d.filter(R=>{var $;return($=R.assignedSchool)==null?void 0:$.toLowerCase().includes(w.toLowerCase())})),o(d)}else o([])},[s,i,w]);const N=async(d,R)=>{j(!0),y(null);try{const $=await ue.get(`http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distribution/${d}/${R}`);$.data.success?(t($.data.data.distributions),o($.data.data.distributions),S(null),A("")):(t([]),o([]),y(`No distributions found for ${d}, ${R}`))}catch($){console.error("Error fetching distributions:",$),t([]),o([]),y("Failed to load distributions")}finally{j(!1)}},T=a.map(d=>({id:d.id,name:d.name,registrationNumber:d.registrationNumber,level:d.level,assignedSchool:d.assignedSchool,allocatedCombinations:d.allocatedCombinations||[],explanation:d.explanation,totalMarks:d.totalMarks,createdAt:d.createdAt})),I=a.map(d=>{var R;return{Name:d.name,"Registration Number":d.registrationNumber,"Total Marks":d.totalMarks,"Assigned School":d.assignedSchool,"Allocated Combinations":((R=d.allocatedCombinations)==null?void 0:R.map($=>$.combinationName).join("; "))||"",Explanation:d.explanation||""}}),V=d=>{S(d),A("")},B=d=>{A(d.target.value),S(null)},_=()=>{if(a.length===0)return;const R=[["Name","Registration Number","Total Marks","Assigned School","Allocated Combinations","Explanation"].join(","),...a.map(u=>{var P,v;return[`"${u.name}"`,u.registrationNumber,u.totalMarks,`"${u.assignedSchool}"`,`"${((P=u.allocatedCombinations)==null?void 0:P.map(O=>O.combinationName).join("; "))||""}"`,`"${(v=u.explanation)==null?void 0:v.replace(/"/g,'""')}"`].join(",")})].join(`
`),$=new Blob([R],{type:"text/csv;charset=utf-8;"}),oe=URL.createObjectURL($),f=document.createElement("a");f.setAttribute("href",oe);const x=i?`-${i.replace(/\s+/g,"-")}`:w?"-school-filter":"";f.setAttribute("download",`distributions-${C}-${b}${x}.csv`),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)},H=()=>{const d=`distributions-${C}-${b}`;return i?`${d}-${i.replace(/\s+/g,"-")}`:w?`${d}-school-filter`:d};return e.jsxs(se,{className:"p-0",children:[e.jsxs(te,{className:"pb-0",children:[e.jsx(ae,{className:"text-xl md:text-2xl",children:"Student Distribution Results"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{children:e.jsxs(ne,{value:C,onValueChange:L,children:[e.jsx(W,{className:"w-full",children:e.jsx(le,{placeholder:"Select Year"})}),e.jsx(X,{children:n.map(d=>e.jsx(z,{value:d,children:d},d))})]})}),e.jsx("div",{children:e.jsxs(ne,{value:b,onValueChange:c,children:[e.jsx(W,{className:"w-full",children:e.jsx(le,{placeholder:"Select Level"})}),e.jsx(X,{children:Object.values(Le).map(d=>e.jsx(z,{value:d,children:d},d))})]})}),e.jsx("div",{children:e.jsxs(ne,{value:i||void 0,onValueChange:V,children:[e.jsx(W,{className:"w-full",children:e.jsx(le,{placeholder:"Filter by School"})}),e.jsxs(X,{children:[e.jsx(z,{value:"all-schools",onSelect:()=>S(null),children:"All Schools"}),m.map(d=>e.jsx(z,{value:d,children:d},d))]})]})}),e.jsx("div",{children:e.jsx(ve,{placeholder:"Search schools...",value:w,onChange:B,className:"w-full"})})]}),e.jsxs("div",{className:"flex justify-center md:justify-end gap-2 mt-4",children:[e.jsxs(E,{onClick:_,disabled:a.length===0,className:"gap-2",size:"sm",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"CSV"})]}),e.jsx(Ps,{data:I,filename:H()})]})]})]}),e.jsx(re,{className:"pt-4 overflow-x-auto",children:k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{children:"Loading distributions..."})}):D?e.jsx("div",{className:"flex justify-center items-center h-64 text-center",children:e.jsx("p",{className:"text-red-500",children:D})}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-2 text-sm text-gray-500",children:[a.length," students found",i?` in ${i}`:"",w?` matching "${w}"`:""]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"min-w-full inline-block align-middle px-4 sm:px-0",children:e.jsx(ys,{students:T})})})]})})]})},ra=[{path:"/",element:jt,protected:!1,children:[{path:"",element:Yt,protected:!1}]},{path:"/portal",element:Ft,protected:!0,children:[{path:"distributed",element:aa,protected:!0},{path:"locate",element:ta,protected:!0}]}],oa=["/","/login"],Oe=({children:s})=>{const{isAuthenticated:t,loading:a}=je(),o=Ee();return a?e.jsx("div",{children:"Loading..."}):t&&oa.includes(o.pathname)?e.jsx(Te,{to:"/portal",replace:!0}):e.jsx(e.Fragment,{children:s})},Me=({children:s,path:t})=>{const{isAuthenticated:a,userData:o,loading:n}=je(),l=Ee();return n?e.jsx(Ne,{}):a?t==="/portal"&&l.pathname==="/portal"?e.jsx(e.Fragment,{children:s}):e.jsx(e.Fragment,{children:s}):e.jsx(Te,{to:"/",state:{from:l},replace:!0})},na=()=>e.jsx(Os,{children:e.jsx(Dt,{children:e.jsxs("main",{className:"overflow-x-hidden",children:[e.jsx(Ms,{children:ra.map((s,t)=>e.jsx(Pe,{path:s.path,element:s.protected?e.jsx(Me,{path:s.path,children:e.jsx(s.element,{})}):e.jsx(Oe,{children:e.jsx(s.element,{})}),children:s.children&&s.children.map((a,o)=>e.jsx(Pe,{path:a.path,element:a.protected?e.jsx(Me,{path:a.path,children:e.jsx(a.element,{})}):e.jsx(Oe,{children:e.jsx(a.element,{})})},o))},t))}),e.jsx(ht,{})]})})});$s(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(na,{})}));
